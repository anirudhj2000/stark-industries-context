# Ontology Setup Templates
# Source of truth for JSON hierarchy generation
#
# TABLE OF CONTENTS:
# - json_schema (line ~10) - JSON output structure
# - structures (line ~40) - Functional, Divisional, Product-Centric, Matrix, Flat
# - industry_functions (line ~160) - Industry-specific function inference
# - function_config (line ~195) - Files and default_teams per function
# - team_config (line ~295) - Extra files for specific team names
# - generation_rules (line ~345) - How to build JSON from user input

# =============================================================================
# JSON OUTPUT SCHEMA
# =============================================================================
# Display fields: name, type, children (for frontend UI)
# Internal fields: _meta (for file creation, ignored by frontend)

json_schema:
  root:
    structure_type: "<structure_key>"  # functional|divisional|product_centric|matrix|flat
    organization:
      name: "organization"
      type: "organization"
      order: 0  # hierarchy depth (0 = root)
      children: []  # populated based on structure
      _meta:
        path: "entities/organization"
        files: []  # all entities stored as files, no subfolders

  node:
    # Display fields (rendered in UI)
    name: "<slug>"  # Slug format: lowercase, hyphens only (e.g., "data-engineering"). See name_format rules.
    display_name: "<display_name>"  # Human-readable name (e.g., "Data Engineering")
    type: "<entity_type>"  # from structure.levels
    order: "<level>"  # hierarchy depth from structures.<type>.levels[].level
    children: []
    # Internal fields (ignored by frontend, used for file creation)
    _meta:
      path: "<from levels.path with {name} substituted>"
      files: ["overview.yaml", "_triage.yaml", ...]  # base + function_config files (no folders, file-based only)

# =============================================================================
# NAME FORMAT (SLUG RULES)
# =============================================================================
name_format:
  type: slug
  description: |
    The `name` field must be a valid slug for URL and filesystem compatibility.
    Applied to ALL entity names before storing in JSON.

  rules:
    - lowercase only
    - replace spaces with hyphens
    - replace underscores with hyphens
    - remove special characters (keep alphanumeric and hyphens only)
    - no leading/trailing hyphens
    - no consecutive hyphens

  algorithm:
    1_lowercase: "Convert to lowercase"
    2_replace_spaces: "Replace spaces with hyphens"
    3_replace_underscores: "Replace underscores with hyphens"
    4_remove_special: "Remove characters not matching [a-z0-9-]"
    5_collapse_hyphens: "Replace multiple consecutive hyphens with single hyphen"
    6_trim_hyphens: "Remove leading and trailing hyphens"

  examples:
    - input: "Data Engineering"
      output: "data-engineering"
    - input: "customer_success"
      output: "customer-success"
    - input: "Team #1"
      output: "team-1"
    - input: "IT"
      output: "it"
    - input: "SRE"
      output: "sre"

# =============================================================================
# STRUCTURE DEFINITIONS
# =============================================================================
structures:

  functional:
    name: Functional Structure
    description: Departments serve the whole company
    hierarchy: org → department → teams
    levels:
      - level: 0
        entity_type: organization
        path: "entities/organization"
        files: [overview.yaml, brand.yaml, strategy.yaml, governance.yaml, _triage.yaml, competitors.yaml, vendors.yaml, partners.yaml, investors.yaml]
      - level: 1
        entity_type: department
        source: user_input
        path: "entities/function/{name}"
        files: [overview.yaml, _triage.yaml]
        teams_folder: teams/
      - level: 2
        entity_type: team
        source: function_config.default_teams
        path: "entities/function/{parent}/teams/{name}"
        files: [overview.yaml, _triage.yaml]

  divisional:
    name: Divisional Structure
    description: Each LOB has its own functions
    hierarchy: org → lob → functions → teams
    levels:
      - level: 0
        entity_type: organization
        path: "entities/organization"
        files: [overview.yaml, brand.yaml, strategy.yaml, governance.yaml, _triage.yaml, competitors.yaml, vendors.yaml, partners.yaml, investors.yaml]
      - level: 1
        entity_type: lob
        source: user_input
        path: "entities/lob/{name}"
        files: [overview.yaml, _triage.yaml]
        functions_folder: functions/
      - level: 2
        entity_type: function
        source: industry_functions
        path: "entities/lob/{parent}/functions/{name}"
        files: [overview.yaml, _triage.yaml]  # + function_config files
        teams_folder: teams/
      - level: 3
        entity_type: team
        source: function_config.default_teams
        path: "entities/lob/{grandparent}/functions/{parent}/teams/{name}"
        files: [overview.yaml, _triage.yaml]

  product_centric:
    name: Product-Centric (Pods)
    description: Cross-functional teams per product
    hierarchy: org → product → functions
    default_functions: [engineering, product, design, data]
    levels:
      - level: 0
        entity_type: organization
        path: "entities/organization"
        files: [overview.yaml, brand.yaml, strategy.yaml, governance.yaml, _triage.yaml, competitors.yaml, vendors.yaml, partners.yaml, investors.yaml]
      - level: 1
        entity_type: product
        source: user_input
        path: "entities/product/{name}"
        files: [overview.yaml, _triage.yaml]
        functions_folder: functions/
      - level: 2
        entity_type: function
        source: default_functions
        path: "entities/product/{parent}/functions/{name}"
        files: [overview.yaml, _triage.yaml]  # + function_config files

  matrix:
    name: Matrix / Hybrid Structure
    description: Functions + Business Units with shared resources
    hierarchy: org → (functions + business_units)
    levels:
      - level: 0
        entity_type: organization
        path: "entities/organization"
        files: [overview.yaml, brand.yaml, strategy.yaml, governance.yaml, _triage.yaml, competitors.yaml, vendors.yaml, partners.yaml, investors.yaml]
      - level: 1
        entity_type: container
        names: [functions, business_units]
      - level: 2a
        entity_type: function
        parent: functions
        source: user_input
        path: "entities/function/{name}"
        files: [overview.yaml, _triage.yaml]  # + function_config files
        teams_folder: teams/
      - level: 2b
        entity_type: business_unit
        parent: business_units
        source: user_input
        path: "entities/business_unit/{name}"
        files: [overview.yaml, _triage.yaml, relationships.yaml]
      - level: 3
        entity_type: team
        parent: function
        source: function_config.default_teams
        path: "entities/function/{parent}/teams/{name}"
        files: [overview.yaml, _triage.yaml]

  flat:
    name: Flat Structure
    description: Minimal hierarchy, self-organizing teams
    hierarchy: org → teams
    levels:
      - level: 0
        entity_type: organization
        path: "entities/organization"
        files: [overview.yaml, brand.yaml, strategy.yaml, governance.yaml, _triage.yaml, competitors.yaml, vendors.yaml]
      - level: 1
        entity_type: team
        source: user_input
        path: "entities/team/{name}"
        files: [overview.yaml, _triage.yaml]

# =============================================================================
# INDUSTRY INFERENCE RULES
# =============================================================================
# Used for Divisional structures to determine functions per LOB

industry_functions:

  tech:
    signals: [software, saas, platform, app, api, tech, insurtech]
    functions: [engineering, product, design, data, operations, finance]

  fintech:
    signals: [fintech, banking, lending, cards, wallet, crypto, payments]
    functions: [product, engineering, risk, compliance, operations, sales, finance]

  retail:
    signals: [retail, ecommerce, shop, store, marketplace]
    functions: [merchandising, operations, marketing, fulfillment, customer-success, finance]

  insurance:
    signals: [insurance, underwriting, claims, policy, actuarial, reinsurance]
    functions: [underwriting, claims, actuarial, sales, compliance, operations, risk]

  manufacturing:
    signals: [food, fmcg, grocery, cpg, manufacturing, production]
    functions: [supply-chain, operations, manufacturing-quality, marketing, sales, fulfillment]

  healthcare:
    signals: [health, medical, clinical, patient, care, pharma]
    functions: [clinical, operations, compliance, technology, revenue-cycle, people]

  default:
    functions: [operations, finance, sales]

# =============================================================================
# FUNCTION CONFIG
# =============================================================================
# Default teams for each function type

function_config:

  # Tech functions
  engineering:
    files: [tech_stack.yaml, system_architecture.yaml, api_integrations.yaml]
    default_teams: [frontend, backend]
  product:
    files: [roadmap.yaml, metrics.yaml]
    default_teams: []
  design:
    files: [design_system.yaml, ux_research.yaml]
    default_teams: []
  data:
    files: [data_models.yaml, data_pipelines.yaml, data_catalog.yaml]
    default_teams: [data-engineering, analytics]

  # Business functions
  finance:
    files: [financials.yaml, budget.yaml, forecasts.yaml]
    default_teams: []
  sales:
    files: [pipeline.yaml, territories.yaml, playbooks.yaml]
    default_teams: [enterprise, smb]
  marketing:
    files: [channels.yaml, campaigns.yaml, brand_assets.yaml]
    default_teams: [growth, content, brand]
  operations:
    files: [processes.yaml, slas.yaml, runbooks.yaml]
    default_teams: []
  people:
    files: [hiring_plan.yaml, programs.yaml, org_chart.yaml]
    default_teams: [recruiting, people-ops]
  legal:
    files: [contracts.yaml, intellectual_property.yaml]
    default_teams: []
  it:
    files: [infrastructure.yaml, vendor_systems.yaml]
    default_teams: []
  security:
    files: [policies.yaml, incidents.yaml, access_controls.yaml]
    default_teams: []

  # Compliance & Risk
  compliance:
    files: [regulations.yaml, licenses.yaml]
    default_teams: []
  risk:
    files: [risk_framework.yaml, limits.yaml]
    default_teams: []

  # Customer-facing
  customer-success:
    files: [health_metrics.yaml, slas.yaml]
    default_teams: [onboarding, support, renewals]

  # Industry-specific: Insurance
  underwriting:
    files: [guidelines.yaml, risk_appetite.yaml, pricing.yaml]
    default_teams: [commercial, personal]
  claims:
    files: [workflows.yaml, reserves.yaml, fraud.yaml]
    default_teams: [intake, adjusters]
  actuarial:
    files: [models.yaml, assumptions.yaml]
    default_teams: [pricing, reserving]

  # Industry-specific: Retail
  fulfillment:
    files: [warehouse_ops.yaml, shipping.yaml, returns.yaml]
    default_teams: [warehouse-ops, shipping]
  merchandising:
    files: [assortment.yaml, pricing.yaml, promotions.yaml]
    default_teams: [buyers, planners]

  # Industry-specific: Manufacturing
  supply-chain:
    files: [suppliers.yaml, inventory.yaml, logistics.yaml]
    default_teams: [procurement, logistics]
  manufacturing-quality:
    files: [standards.yaml, inspections.yaml, certifications.yaml]
    default_teams: []

  # Industry-specific: Healthcare
  clinical:
    files: [protocols.yaml, workflows.yaml]
    default_teams: []
  revenue-cycle:
    files: [billing.yaml, collections.yaml]
    default_teams: []
  technology:
    files: [systems.yaml, integrations.yaml]
    default_teams: []

# =============================================================================
# TEAM CONFIG
# =============================================================================
# Extra files for specific team names (used in flat structure)
# Skill appends these to base files [overview.yaml, _triage.yaml]

team_config:

  # Engineering teams
  backend:
    files: [tech_stack.yaml, system_architecture.yaml, api_integrations.yaml]
  frontend:
    files: [tech_stack.yaml, design_tokens.yaml, component_library.yaml]
  mobile:
    files: [tech_stack.yaml, app_releases.yaml]
  devops:
    files: [infrastructure.yaml, ci_cd.yaml, monitoring.yaml]
  platform:
    files: [tech_stack.yaml, system_architecture.yaml]
  sre:
    files: [runbooks.yaml, slas.yaml, incidents.yaml]
  infra:
    files: [infrastructure.yaml, ci_cd.yaml]

  # Design teams
  design:
    files: [design_system.yaml, ux_research.yaml]
  ux:
    files: [design_system.yaml, ux_research.yaml]

  # Data teams
  data:
    files: [data_models.yaml, data_pipelines.yaml]
  analytics:
    files: [dashboards.yaml, metrics.yaml]
  data-engineering:
    files: [data_pipelines.yaml, data_catalog.yaml]

  # Product teams
  product:
    files: [roadmap.yaml, metrics.yaml]

  # QA teams
  qa:
    files: [test_strategy.yaml, test_cases.yaml]
  quality:
    files: [test_strategy.yaml, test_cases.yaml]

# =============================================================================
# JSON GENERATION RULES
# =============================================================================
# How to build JSON from user input + inference

generation_rules:
  1_get_structure: "Use structures.<type>.levels to determine hierarchy depth"
  2_populate_level_1: "Use user_input for level 1 entities"
  3_infer_level_2: |
    - For divisional: Match LOB names against industry_functions signals
    - For product_centric: Use default_functions
    - For matrix: Use user_input for both functions and business_units
  4_infer_teams: "Look up function_config.<function>.default_teams"
  5_handle_unknown: |
    - Unknown industry: Ask clarifying question OR use default functions
    - Unknown function: Leave children empty
    - User skips: Use minimal defaults

# =============================================================================
# DISPLAY NAME GENERATION
# =============================================================================
# How to generate human-readable display_name from normalized name

display_name_rules:
  description: |
    Convert normalized entity name to human-readable display name.
    Applied automatically during JSON generation for every node.

  algorithm:
    1_replace_separators: "Replace underscores '_' and hyphens '-' with spaces"
    2_title_case: "Capitalize first letter of each word"
    3_preserve_acronyms: "Keep common acronyms uppercase (see list below)"

  examples:
    - name: "engineering"
      display_name: "Engineering"
    - name: "data-engineering"
      display_name: "Data Engineering"
    - name: "customer-success"
      display_name: "Customer Success"
    - name: "it"
      display_name: "IT"
    - name: "sre"
      display_name: "SRE"
    - name: "qa"
      display_name: "QA"
    - name: "hr"
      display_name: "HR"
    - name: "manufacturing-quality"
      display_name: "Manufacturing Quality"
    - name: "api-integrations"
      display_name: "API Integrations"
    - name: "team-1"
      display_name: "Team 1"

  acronyms_to_preserve: [IT, HR, QA, SRE, API, CTO, CEO, CFO, COO, VP, SVP, EVP, LOB, SMB]

# =============================================================================
# ENTITY DELETION RULES
# =============================================================================
# Safety checks before removing entities from the structure

deletion_rules:
  description: |
    Before deleting/removing an entity from the ontology structure,
    verify no people are assigned to that entity. If people exist,
    block the deletion and guide the user to reassign/remove them first.

  check_sequence:
    1_identify_entity: "Get the entity name and path from the structure"
    2_scan_people: "Scan entities/person/*/overview.yaml for team: field matches"
    3_check_children: "Recursively check all child entities for assigned people"
    4_block_or_allow: "If people found, block deletion with list; otherwise allow"

  people_check:
    location: "entities/person/{person_name}/overview.yaml"
    field: "team"
    match_type: "exact match on entity name (normalized, case-insensitive)"

  # IMPORTANT: Use this EXACT format. Do NOT mention Playbook or any app name.
  blocking_response_template: |
    Cannot delete '{entity_name}' - these people are currently assigned:
    - {person_name}

    Please reassign or remove them from the portal first.

  # Do NOT say "ask me again" or mention any app by name.

  edge_cases:
    no_person_directory: "Allow deletion (no people to check)"
    person_without_team_field: "Ignore that person (not assigned anywhere)"
    case_sensitivity: "Normalize both entity name and team field before comparing"
    recursive_children: "When deleting parent, check ALL descendants too"
